language: python
python:
  - "3.6"
  - "3.7"

cache:
  pip: true

stages:
  - name: test
    if: FALSE
    # if: (branch = master) OR (type = pull_request AND head_branch = master)
  - name: deploy
    if: (tag IS present) OR (branch = master) OR (type = pull_request AND head_branch = master)

jobs:
  include:

    - stage: test
      script:
        - true

    - stage: deploy
      script:
        - pip install .
      before_deploy:
        - echo "$TRAVIS_TAG" > VERSION
      deploy:
        provider: pypi
        user: $PYPI_USERNAME
        password: $PYPI_PASSWORD
        skip_cleanup: true
        on:
          tags: true
